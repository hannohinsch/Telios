	public	logo

cm_data segment public 'code'

allocate = 0
include data.pub

cscrn	dw	cscrnz-cscrna
cscrna	db	12
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,rvideof,' Telios ',nattrf,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,' Asynchronous Commun'
	db	'ications ',176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' Genasys Corporation'
	db	  9,  9,  9,'  ',177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' 11820 Parklawn Driv'
	db	'e',  9,  9,  9,'  ',177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' Rockville, MD 20852'
	db	  9,  9,  9,'  ',177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' (301) 770-4600 ',  9,  9
	db	  9,'  ',177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,  9,  9,  9,  9,  9,'  ',177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' Version 3X04',  9,  9,  9
	db	  9,'  ',177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,' Copyright (c) 1983,'
	db	'84,85,86 Hanno Hinsch ',177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,13,10
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,176,176
	db	176,176,176,176,176,176,176,176,176,176,177,177
	db	177,177,177,177,177,177,177,177,177,177,177,177
	db	177,177,177,177,177,177,177,177,13,10

cscrnz	db	?

cstar	dw	0			;offset of first star
histar	equ	84			;highest offset (twice num of stars
stars	dw	0e1bh			;1
	dw	0d1bh			;2
	dw	0c1bh			;3
	dw	0c1ch			;4
	dw	0c1dh			;5
	dw	0c1eh			;6
	dw	0c1fh			;7
	dw	0c20h			;8
	dw	0c21h			;9
	dw	0c22h			;10
	dw	0c23h
	dw	0c24h
	dw	0c25h
	dw	0c26h
	dw	0c27h
	dw	0c28h
	dw	0c29h
	dw	0c2ah
	dw	0c2bh
	dw	0c2ch
	dw	0b2ch
	dw	0b2ch
	dw	0c2ch
	dw	0c2bh
	dw	0c2ah
	dw	0c29h
	dw	0c28h
	dw	0c27h
	dw	0c26h
	dw	0c25h
	dw	0c24h
	dw	0c23h
	dw	0c22h			;10
	dw	0c21h			;9
	dw	0c20h			;8
	dw	0c1fh			;7
	dw	0c1eh			;6
	dw	0c1dh			;5
	dw	0c1ch			;4
	dw	0c1bh			;3
	dw	0d1bh			;2
	dw	0e1bh			;1

lflag	db	0
flash	equ	1			;flash, don't wait for cr

emislogo dw	emislz-emisla
emisla	db	'*** EMIS compatible ***'
emislz	equ	$

bosslogo dw	bosslz-bossla
bossla	db	'*** BASIC/4 compatible ***'
bosslz	equ	$

cm_data ends

cm_code segment public 'code'
assume	cs:cm_code
assume	ds:cm_data

extrn	rdcrsr:near,setcrsr:near,nattr:near,hilite:near,wrtchar:near
extrn	wswitch:near,kbread:near,rvideo:near,display:near,rdchar:near
extrn	csettle:near,qwrite:near

;------ print copyright screen and wait for char
;	unless al <> 0 on entry, in which case just flash logo
logo	proc	near
	push	ax
	push	cx
	push	dx
	push	si

	and	lflag,255-flash 	;check for quick logo
	or	al,al
	jz	logo1
	or	lflag,flash

;	now clear entire screen and show copyright msg
logo1:	mov	al,4		;whole screen window
	call	wswitch

	mov	si,offset cscrn
	call	qwrite		  ;print copyright screen

	test	parm4,emis+boss ;special variant?
	jz	logo1b		;no
	mov	dx,(256*21)+30	;row 21, col 30
	call	setcrsr
	mov	si,offset emislogo	;assume emis
	test	parm4,boss		;is it boss?
	jz	logo1a			;no
	mov	si,offset bosslogo
logo1a: call	qwrite			;write it

logo1b: mov	dx,0ffffh	;mov cursor way off screen
	call	setcrsr
	call	csettle

	sub	cx,cx
logo2:	loop	logo2		;wait half second
	test	lflag,flash
	jnz	logo3

	mov	cx,20000
inilp:	; wait for user to press key, or wait about 2 seconds
	call	kbread		;check keybd
	loopz	inilp		;no character ready

logo3:	mov	al,12		;clear screen
	call	display
	mov	al,1		;switch to normal window
	call	wswitch

	pop	si
	pop	dx
	pop	cx
	pop	ax
	ret
logo	endp


;------ nstar: twinkle the logo to woo the innocent
nstar	proc	near
	push	si
	push	dx
	push	cx
	push	ax

	call	rdcrsr		;save current cursor
	push	dx

;	select next star
	mov	si,cstar
	add	si,2
	cmp	si,histar		;end of cycle?
	jb	ns1
	sub	si,si
ns1:	mov	cstar,si		;store pointer to new star

	mov	dx,stars [si]		;get position of new star
	call	setcrsr 		;move cursor to star

	call	rdchar
	push	ax

	mov	al,32			;blank first for effect
	call	wrtchar

;	hide the cursor for a moment
	push	dx
	mov	dx,2060h		;nowhere on the screen
	call	setcrsr
;	wait
	mov	cx,5000
ns1a:	loop	ns1a
	pop	dx
	call	setcrsr

;	write new star w/ hilite
	call	hilite
	pop	ax			;recover char
	call	wrtchar

;	hide the cursor for a moment
	push	dx
	mov	dx,2060h		;nowhere on the screen
	call	setcrsr
;	wait
	mov	cx,25000
ns2:	loop	ns2
	pop	dx
	call	setcrsr

	call	nattr			;restore normal attribute
	call	rdchar
	call	wrtchar

	pop	dx
	call	setcrsr 		;restore cursor

	pop	ax
	pop	cx
	pop	dx
	pop	si
	ret
nstar	endp

cm_code ends
end
